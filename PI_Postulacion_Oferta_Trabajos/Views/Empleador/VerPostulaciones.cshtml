@model IEnumerable<PI_Postulacion_Oferta_Trabajos.Models.Oferta>

@{
    ViewData["Title"] = "Ver Postulaciones";
    var nombreEmpresa = ViewBag.NombreEmpresa;
}

<h2 class="my-3"><i class="bi bi-building-fill"></i> Ver Postulaciones - @nombreEmpresa</h2>

<div class="row">
    <div class="col-md-3">
        <!-- Filtros -->
        <form method="get" class="bg-light p-4 rounded shadow-sm">
            <!-- Filtro por rango de fechas de publicación -->
            <div class="form-group">
                <label for="fechaDesde">Fecha Desde</label>
                <input type="date" name="fechaDesde" class="form-control" id="fechaDesde" />
            </div>

            <div class="form-group">
                <label for="fechaHasta">Fecha Hasta</label>
                <input type="date" name="fechaHasta" class="form-control" id="fechaHasta" />
            </div>

            <!-- Filtro por provincia -->
            <div class="form-group">
                <label for="provincia">Provincia</label>
                <select class="form-select" id="provincia" name="provincia">
                    <option value="">Seleccione una provincia</option>
                    @foreach (var provincia in ViewBag.Provincias)
                    {
                        <option value="@provincia.ProId">@provincia.ProNombre</option>
                    }
                </select>
            </div>

            <!-- Filtro por ciudad -->
            <div class="form-group">
                <label for="ciudad">Ciudad</label>
                <select class="form-select" id="ciudad" name="ciudad">
                    <option value="">Seleccione una ciudad</option>
                    @foreach (var ciudad in ViewBag.Ciudades)
                    {
                        <option value="@ciudad.CidId">@ciudad.CidNombre</option>
                    }
                </select>
            </div>

            <!-- Filtro por área laboral -->
            <div class="form-group">
                <label for="areaLaboral">Área Laboral</label>
                <select class="form-select" id="areaLaboral" name="areaLaboral">
                    <option value="">Seleccione un área laboral</option>
                    @foreach (var areaLaboral in ViewBag.AreasLaborales)
                    {
                        <option value="@areaLaboral.ArlId">@areaLaboral.ArlNombre</option>
                    }
                </select>
            </div>

            <!-- Filtro por puesto laboral -->
            <div class="form-group">
                <label for="puestoLaboral">Puesto Laboral</label>
                <select class="form-select" id="puestoLaboral" name="puestoLaboral">
                    <option value="">Seleccione un puesto laboral</option>
                    @foreach (var puestoLaboral in ViewBag.PuestosLaborales)
                    {
                        <option value="@puestoLaboral.PulId">@puestoLaboral.PulNombre</option>
                    }
                </select>
            </div>

            <!-- Filtro por modalidad de oferta -->
            <div class="form-group">
                <label for="ofertaModalidad">Modalidad</label>
                <select class="form-select" id="ofertaModalidad" name="ofertaModalidad">
                    <option value="">Seleccione una modalidad</option>
                    @foreach (var modalidad in ViewBag.OfertasModalidades)
                    {
                        <option value="@modalidad.OfmId">@modalidad.OfmNombre</option>
                    }
                </select>
            </div>

            <!-- Filtro por salario mínimo -->
            <div class="form-group">
                <label for="salarioMinimo">Salario Mínimo</label>
                <input type="number" step="0.01" name="salarioMinimo" class="form-control" id="salarioMinimo" />
            </div>

            <!-- Filtro por salario máximo -->
            <div class="form-group">
                <label for="salarioMaximo">Salario Máximo</label>
                <input type="number" step="0.01" name="salarioMaximo" class="form-control" id="salarioMaximo" />
            </div>

            <!-- Filtro por tipo de contrato -->
            <div class="form-group">
                <label for="tipoContrato">Tipo de Contrato</label>
                <select class="form-select" id="tipoContrato" name="tipoContrato">
                    <option value="">Seleccione un tipo de contrato</option>
                    <option value="Por horas">Por horas</option>
                    <option value="Medio tiempo">Medio tiempo</option>
                    <option value="Tiempo completo">Tiempo completo</option>
                    <option value="Temporal">Temporal</option>
                    <option value="Freelance">Freelance</option>
                    <option value="Pasantía">Pasantía</option>
                    <option value="Por obra o servicio">Por obra o servicio</option>
                </select>
            </div>

            <!-- Filtro por existencia de postulantes -->
            <div class="form-group">
                <label for="tienePostulantes">¿Tiene Postulantes?</label>
                <select id="tienePostulantes" name="tienePostulantes" class="form-control">
                    <option value="">Seleccione una opción</option>
                    <option value="true">Sí</option>
                    <option value="false">No</option>
                </select>
            </div>

            <!-- Filtro por estado de la postulación -->
            <div class="form-group">
                <label for="estadoPostulacion">Estado de la Postulación</label>
                <select name="estadoPostulacion" class="form-control" id="estadoPostulacion">
                    <option value="">Cualquiera</option>
                    @foreach (var estado in ViewBag.EstadosPostulacion)
                    {
                        <option value="@estado.EspId">@estado.EspNombre</option>
                    }
                </select>
            </div>

            <button type="submit" class="btn btn-custom mt-3">Filtrar</button>
        </form>
    </div>

    <div class="col-md-9">
        <!-- Ofertas publicadas -->
        <div class="row">
            @foreach (var oferta in Model)
            {
                var cantidadPostulantes = oferta.Postulaciones.Count();

                <div class="card mb-3" style="width: 100%;">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-person-bounding-box"></i> @oferta.OfeTitulo</h5>
                        <p class="card-text">
                            @if (oferta.OfeDescripcion.Length > 150)
                            {
                                @(oferta.OfeDescripcion.Substring(0, 150) + "...")
                            }
                            else
                            {
                                @oferta.OfeDescripcion
                            }
                        </p>
                        <p class="card-text"><i class="bi bi-calendar2-heart-fill"></i>  <strong>Fecha de Publicación:</strong> @oferta.OfeFechaPublicacion.ToShortDateString()</p>
                        <p class="card-text"><i class="bi bi-people-fill"></i>  <strong>Cantidad de Postulantes:</strong> @cantidadPostulantes</p>
                        <p class="card-text"><i class="bi bi-hourglass-bottom"></i>  <strong>Tipo de Contrato:</strong> @oferta.OfeTipoContrato</p>
                        <a href="@Url.Action("VerCandidatos", "Empleador", new { ofertaId = oferta.OfeId })" class="btn btn-custom">Ver Candidatos</a>
                        <a href="@Url.Action("EditarOferta", "Empleador", new { id = oferta.OfeId })" class="btn btn-outline-dark">Editar Oferta</a>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

